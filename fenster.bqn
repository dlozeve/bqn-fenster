âŸ¨
  FensterLoop,
  OpenWindow,
  CloseWindow,
  _render,
  RenderArray
  _display,
  Black,
  White,
  Gray,
  Red,
  Green,
  Blue,
  HSVtoRGB
âŸ©â‡

## FFI functions

FensterFFIâ†"lib.so"âŠ¸â€¢FFI

fensterOpenâ†FensterFFI"i8"â€¿"fenster_open"â€¿">*:i8"
fensterLoopâ†FensterFFI"i8"â€¿"fenster_loop"â€¿">*:i8"
fensterCloseâ†FensterFFI""â€¿"fenster_close"â€¿">*:i8"
fensterSleepâ†FensterFFI""â€¿"fenster_sleep"â€¿">u32"
fensterTimeâ†FensterFFI"u64"â€¿"fenster_time"

fensterInitâ†FensterFFI"*:i8"â€¿"fenster_init"â€¿"u32"â€¿"u32"â€¿"u32"â€¿"*u8:c8"
fensterGetWidthâ†FensterFFI"u32"â€¿"fenster_get_width"â€¿">*:i8"
fensterGetHeightâ†FensterFFI"u32"â€¿"fenster_get_height"â€¿">*:i8"
fensterGetPixelâ†FensterFFI"u32"â€¿"fenster_get_pixel"â€¿"*:i8"â€¿"u32"â€¿"u32"
fensterSetPixelâ†FensterFFI""â€¿"fenster_set_pixel"â€¿"*:i8"â€¿"u32"â€¿"u32"â€¿"u32"
fensterSetArrayâ†FensterFFI""â€¿"fenster_set_array"â€¿"*:i8"â€¿"u32"â€¿"u32"â€¿"u32"â€¿"u32"â€¿"*u32"

## Low-level functions

# Open a window with given width, height, and title
# Returns the window's handle.
OpenWindowâ†{ğ•Šwâ€¿hâ€¿t:
  fâ†FensterInitâŸ¨w,h,1+â‰ t,tâˆ¾@âŸ©
  FensterOpen f
  FensterLoop f
  f
}

# Close a window.
CloseWindowâ†{ğ•Šf:
  FensterClose f
  FensterLoop f
}

# Render a function in the window.
# The function should take a list xâ€¿y of coordinates and return an râ€¿ğ•˜â€¿b color.
_renderâ†{Func _ğ•£ f:
  wâ†FensterGetWidth f
  hâ†FensterGetHeight f
  {ğ•Šxâ€¿y:
    râ€¿gâ€¿bâ†Func xâ€¿y
    câ†+Â´(âŒ½256â‹†â†•3)Ã—âŒŠrâ€¿gâ€¿bÃ—255
    FensterSetPixel fâ€¿xâ€¿yâ€¿c
  }Â¨â¥Š(â†•w)â‹ˆâŒœâ†•h
  FensterLoop f
  f
}

# Render an array directly.
RenderArrayâ†{bufğ•Šf:
  bufwâ€¿bufhâ†â‰¢buf
  FensterSetArrayâŸ¨f,0,0,bufw,bufh,bufâŸ©
}

## High-level function

# Open a window, render a function in it, and wait for the user to close it.
_displayâ†{Func _ğ•£ wâ€¿h:
  winâ†OpenWindow wâ€¿hâ€¿"bqn-fenster"
  Func _render win
  âŠ¢â€¢_while_(Â¬FensterLoop)win
  CloseWindow win
}

## Utilities

Blackâ†0â€¿0â€¿0Ë™
Whiteâ†1â€¿1â€¿1Ë™
Grayâ†{ğ•©â€¿ğ•©â€¿ğ•©}
Redâ†1â€¿0â€¿0Ë™
Greenâ†0â€¿1â€¿0Ë™
Blueâ†0â€¿0â€¿1Ë™

# Convert colors from HSV to RGB.
# ğ•© is a triple 0 â‰¤ hâ€¿sâ€¿v â‰¤ 360â€¿1â€¿1
# Output is a triple 0 â‰¤ râ€¿gâ€¿b â‰¤ 1
HSVtoRGBâ†{ğ•ŠâŸ¨h,s,vâŸ©:
  câ†vÃ—s
  xâ†cÃ—1-|1-2|hÃ·60
  mâ†v-c
  râ€¿gâ€¿bâ†(âŒŠhÃ·60)âŠ‘âŸ¨câ€¿xâ€¿0,xâ€¿câ€¿0,0â€¿câ€¿x,0â€¿xâ€¿c,xâ€¿0â€¿c,câ€¿0â€¿xâŸ©
  m+râ€¿gâ€¿b
}
